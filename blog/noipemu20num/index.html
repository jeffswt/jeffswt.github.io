<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#292d35">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>NOIP-EMU-141005-num 数字&nbsp;&nbsp;|&nbsp;&nbsp;jeffswt: the ac moments</title>
  <link rel="shortcut icon" href="/assets/images/favicon.png">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/font-awesome.css">
  <link rel="stylesheet" href="/assets/katex/katex.css">
  <link rel="stylesheet" href="/assets/gitment/gitment.css">
</head>

<body>
  <div class="topbar">
    <div class="bar">
      <span class="avatar-icon"><svg version="1.1" height="40px" version="1.1" viewBox="0 0 48 48" width="40px">
        <polygon points="-0.5,16 -0.5,37 0.5,34 0.5,32 1.5,28.8 1.5,24 1.5,21 2.5,17.6 2.5,16 1,14.9 "/>
        <polygon points="44,0.5 45,0.5 46.1,1.1 46.9,1.9 47.2,2.8 47.5,4.8 47.5,7 48,43.8 47.6,45.8 46.4,47.6
        	44.8,48.5 38,48.5 36.8,47.2 36.1,46.1 34.2,44.7 32.6,43.5 31.1,40.8 29.5,38.8 27.8,35.9 26.9,35.4 29.5,35.3 32.7,28.4
        	31.4,27.8 28.7,33.8 26.9,34.1 25.7,33.3 23.5,33.4 21,32.8 19.3,32.2 18.3,30.4 17.3,27.3 19.3,27.9 20.8,26.6 20.4,25.3 21.3,24
        	22.2,23 20.3,21.3 17.8,20.8 16.2,21.5 15.5,23 15.5,25 14.4,26 12.8,26.6 11.2,29.2 10.6,31.1 11.2,34.3 10.9,37.7 11,39.5
        	11.8,42.3 9.5,39.6 8.6,37 7.8,35.1 7.1,33.4 6.6,31 6,28.1 5.6,23.5 6.2,21.8 5.6,19.3 6.3,18.1 8.4,17 10.8,14.5 13,14.5
        	15.8,16.5 19,16.5 22.2,14.3 24,15 25.4,13.5 29,13.5 32.3,12.3 34.5,11.3 36,10.5 36.4,9 39.3,8.8 40.1,7.5 42,7.5 43.6,6.9
        	44,5.3 44.8,3.9 45.2,2.7 "/>
        <polygon points="17.5,34 17.5,37 18.2,37.5 22.8,35.4 21.1,34.7 17.9,34 "/>
        <polygon points="19,43.1 20.6,42.4 22.1,41.4 24,39.5 25,39.5 26.8,41.3 29.3,44.6 24,43.3 "/>
      </svg></span>
      <span class="site-title"><a class="site-title-href" href="/blog/">
        jeffswt: the ac moments
      </a></span>
    </div>
  </div>
  <div class="site-content">
    <div class="blog-post" lang="zh">
      <div class="post-header">
        <h1 class="title">
          NOIP-EMU-141005-num 数字
        </h1>
        <span class="tags">
          <a class="tag" href="/blog/archive/?q=Problems" target="_self">
            <i class="fa fa-tag"></i> Problems
          </a>
          <a class="tag" href="/blog/archive/?q=NOIP Emulation" target="_self">
            <i class="fa fa-tag"></i> NOIP Emulation
          </a>
          <a class="tag" href="/blog/archive/?q=Implementation" target="_self">
            <i class="fa fa-tag"></i> Implementation
          </a>
          <a class="tag" href="/blog/archive/?q=Mathematics" target="_self">
            <i class="fa fa-tag"></i> Mathematics
          </a>
        </span>
        <span class="date" title="12:22:13 | 30 October, 2016">
          30 October, 2016
        </span>
      </div>
      <div class="post-content">
        <h3 id="问题描述">问题描述</h3>
<p>一个数字被称为好数字当他满足下列条件: 1. 它有 2*n 个数位, n 是正整数 (允许有前导 0). 2. 构成它的每个数字都在给定的数字集合 S 中. 3. 它前 n 位之和与后 n 位之和相等或者它奇数位之和与偶数位之和相等例如对于 n=2, S={1, 2}, 合法的好数字有 1111, 1122, 1212, 1221, 2112, 2121, 2211, 2222 这样 8 种. 已知 n, 求合法的好数字的个数 mod 999983.</p>
<h3 id="输入格式">输入格式</h3>
<p>第一行一个数 n. 接下来一个长度不超过 10 的字符串, 表示给定的数字集合.</p>
<h3 id="输出格式">输出格式</h3>
<p>一行一个数字表示合法的好数字的个数 mod 999983.</p>
<!-- More -->
<h3 id="样例输入">样例输入</h3>
<pre><code>2
0987654321</code></pre>
<h3 id="样例输出">样例输出</h3>
<pre><code>1240</code></pre>
<h3 id="数据规模">数据规模</h3>
<p>对于 20% 的数据, n≤7. 对于 100% 的. 据, n≤1000,|S|≤10.</p>
<h3 id="explanation">Explanation</h3>
<p>我们用类分治的想法来解这一道题. 首先将整个数列分成四部分:</p>
<ol type="1">
<li>在前一半, 位置为奇数位的数构成的数列 (<code>a[]</code>)</li>
<li>在前一半, 位置为偶数位的数构成的数列 (<code>b[]</code>)</li>
<li>在后一半, 位置为奇数位的数构成的数列 (<code>c[]</code>)</li>
<li>在后一半, 位置为偶数位的数构成的数列 (<code>d[]</code>)</li>
</ol>
<p>然后由于这四部分分别独立, 所以可以用 dp 在<span class="math inline">\(O(n^2)\)</span> 时间内求出来排列它们的方案数. 进一步, 我们可以知道最终的方案数为 <span class="math inline">\(a + b = c + d\ or\ a + c = b + d\)</span>.</p>
<p>但是这就带来一个问题, 常数大约为<span class="math inline">\(100\)</span> 的 $O (n^2) 做法一定会 TLE (实测大概需要 4 秒左右, 但是 常数实在太大无法优化, 也就是已经达到了渐进复杂度极限. 所以我们现在要从另一个角度来看这件事. 我们对这个方程进行化简:</p>
<p><span class="math display">\[let\ dp[0]_i\ be\ a+b, dp[1]_i\ be\ c+d, dp[2]_i\ be\ a+c, dp[3]_i\ be\ b+d.\]</span></p>
<p><span class="math display">\[res = \sum_{i=0}^{m}(dp[0]_i \times dp[1]_i) + \sum_{i=0}^{m}(dp[2]_i \times dp[3]_i) - \sum_{i=0}^{m}a_i d_i \times \sum_{i=0}^{m}b_i c_i\]</span></p>
<p><span class="math display">\[= \sum_{i=0}^{m}(dp[0]_i \times dp[1]_i + dp[2]_i \times dp[3]_i) - \sum_{i=0}^{m}a_i d_i \times \sum_{i=0}^{m}b_i c_i\]</span></p>
<p><span class="math display">\[= \sum_{i=0}^{m}(\sum_{j=0}^{m}a_j b_{i-j} \times \sum_{j=0}^{m}c_j d_{i-j} + \sum_{j=0}^{m}a_j c_{i-j} \times \sum_{j=0}^{m}b_j d_{i-j}) - \sum_{i=0}^{m}a_i d_i \times \sum_{i=0}^{m}b_i c_i\]</span></p>
<p><span class="math display">\[\because a = d, b = c\]</span></p>
<p><span class="math display">\[\therefore res = 2\sum_{i=0}^{m}(\sum_{j=0}^{m} a_j b_{i-j})^2 - \sum_{i=0}^{m} a_i^2 - \sum_{i=0}^{m} b_i^2\]</span></p>
<p><span class="math display">\[\because \sum_{j=0}^{m} a_j b_{i-j} = dp_{n,i}\]</span></p>
<p><span class="math display">\[\therefore res = 2\sum_{i=0}^{m} dp[n][i] - \sum_{i=0}^{m} dp[\lceil \frac{n}{2} \rceil][i]^2 - \sum_{i=0}^{m} dp[\lfloor \frac{n}{2} \rfloor][i]^2\]</span></p>
<p>然后这就被优化成了一个常数为<span class="math inline">\(10\)</span> 的<span class="math inline">\(O(n^2)\)</span> 算法, 刚好踩着 0. 9 秒的时限能够 AC.</p>
<h3 id="example-code">Example Code</h3>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">
<span class="ot">#include &lt;iostream&gt;</span>
<span class="ot">#include &lt;cstdlib&gt;</span>
<span class="ot">#include &lt;cstdio&gt;</span>
<span class="ot">#include &lt;cstring&gt;</span>
<span class="ot">#include &lt;cmath&gt;</span>

<span class="kw">using</span> <span class="kw">namespace</span> std;
<span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> lli;
<span class="dt">const</span> <span class="dt">int</span> maxn = <span class="dv">1010</span>, maxm = <span class="dv">10100</span>, maxx = <span class="dv">10</span>;
<span class="dt">const</span> lli modr = <span class="dv">999983</span>;
<span class="co">// #define USE_BRUTE_FORCE</span>

<span class="dt">bool</span> avail[maxx]; <span class="co">// Available numbers</span>
<span class="dt">int</span> n, availmax;
<span class="ot">#ifdef USE_BRUTE_FORCE</span>
lli dp[<span class="dv">2</span>][maxm]; <span class="co">// Rolling array, dp[i][j] = count(len = i, sum = j)</span>
<span class="dt">int</span> dp_idx = <span class="dv">0</span>;
<span class="ot">#else</span>
lli dp[maxn][maxm];
<span class="ot">#endif</span>

<span class="ot">#ifdef USE_BRUTE_FORCE</span>
lli proc_dp[<span class="dv">4</span>][maxm];
<span class="dt">void</span> proc_sub(<span class="dt">int</span> pos, lli a[], lli b[], <span class="dt">int</span> max_size)
{
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= max_size; i++) {
        proc_dp[pos][i] = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= i; j++)
            proc_dp[pos][i] += a[j] * b[i - j];
        proc_dp[pos][i] %= modr;
    }
    <span class="kw">return</span> ;
}
lli proc(lli a[], lli b[], lli c[], lli d[])
{
    <span class="co">// Returns a+b=c+d || a+c=b+d =&gt; a=d, b=c</span>
    <span class="dt">int</span> max_size = n;
    <span class="kw">for</span> (<span class="dt">int</span> i = maxx - <span class="dv">1</span>; i &gt;= <span class="dv">0</span>; i--)
        <span class="kw">if</span> (avail[i]) { max_size *= i; <span class="kw">break</span>; }
    <span class="co">// Preprocess initial data</span>
    proc_sub(<span class="dv">0</span>, a, b, max_size);
    proc_sub(<span class="dv">1</span>, c, d, max_size);
    proc_sub(<span class="dv">2</span>, a, c, max_size);
    proc_sub(<span class="dv">3</span>, b, d, max_size);
    <span class="co">// Type 1 (+) : a+b=c+d</span>
    lli res = <span class="dv">0</span>, res_a = <span class="dv">0</span>, res_b = <span class="dv">0</span>;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= max_size; i++)
        res_a += proc_dp[<span class="dv">0</span>][i] * proc_dp[<span class="dv">1</span>][i];
    res += res_a % modr;
    <span class="co">// Type 2 (+) : a+c=b+d</span>
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= max_size; i++)
        res_b += proc_dp[<span class="dv">2</span>][i] * proc_dp[<span class="dv">3</span>][i];
    res += res_b % modr;
    <span class="co">// Type 3 (-) : a=d, b=c</span>
    res_a = <span class="dv">0</span>, res_b = <span class="dv">0</span>, res %= modr;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= max_size; i++)
        res_a += a[i] * d[i];
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= max_size; i++)
        res_b += b[i] * c[i];
    res -= ((res_a % modr) * (res_b % modr)) % modr;
    <span class="kw">return</span> res;
}
<span class="ot">#else</span>
<span class="ot">#endif</span>

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span>** argv)
{
    scanf(<span class="st">"</span><span class="ch">%d</span><span class="st">"</span>, &amp;n);
    <span class="dt">char</span> str[<span class="dv">20</span>];
    scanf(<span class="st">"</span><span class="ch">%s</span><span class="st">"</span>, str);
    <span class="kw">for</span> (<span class="dt">unsigned</span> <span class="dt">int</span> i = <span class="dv">0</span>; i &lt; strlen(str); i++) {
        avail[str[i] - <span class="st">'0'</span>] = <span class="kw">true</span>;
        availmax = max(availmax, str[i] - <span class="st">'0'</span>);
    }
    <span class="co">// Done input, ready to dp.</span>
    <span class="ot">#ifdef USE_BRUTE_FORCE</span>
    <span class="ot">#define dp_now dp[dp_idx]</span>
    <span class="ot">#define dp_last dp[!dp_idx]</span>
    <span class="dt">int</span> maxdp = <span class="dv">0</span>;
    dp_now[<span class="dv">0</span>] = <span class="dv">1</span>;
    <span class="dt">int</span> cl_n_2 = (n + <span class="dv">1</span>) / <span class="dv">2</span>;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= cl_n_2; i++) {
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= maxdp + <span class="dv">9</span>; j++)
            dp_last[j] = <span class="dv">0</span>;
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= maxdp; j++)
            <span class="kw">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; maxx; k++)
                <span class="kw">if</span> (avail[k])
                    dp_last[j + k] += dp_now[j];
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= maxdp + <span class="dv">10</span>; j++)
            dp_last[j] %= modr;
        dp_idx ^= <span class="dv">1</span>;
        maxdp += availmax;
    }
    dp_idx ^= <span class="dv">1</span>;
    <span class="co">// Processing with distinction</span>
    lli res = <span class="dv">0</span>;
    <span class="kw">if</span> (n % <span class="dv">2</span> == <span class="dv">0</span>)
        res = proc(dp_last, dp_last, dp_last, dp_last);
    <span class="kw">else</span>
        res = proc(dp_now, dp_last, dp_last, dp_now);
    <span class="ot">#else</span>
    <span class="co">// Do not use brute force, or rolling arrays</span>
    dp[<span class="dv">0</span>][<span class="dv">0</span>] = <span class="dv">1</span>;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; i++) {
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= i * availmax; j++)
            <span class="kw">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt;= availmax; k++)
                <span class="kw">if</span> (avail[k])
                    dp[i][j + k] += dp[i - <span class="dv">1</span>][j];
        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt;= (i + <span class="dv">1</span>) * availmax; j++)
            dp[i][j] %= modr;
    }
    lli res = <span class="dv">0</span>, A = <span class="dv">0</span>, B = <span class="dv">0</span>;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= n * availmax; i++)
        res += <span class="dv">2</span> * dp[n][i] * dp[n][i];
    res %= modr;
    <span class="dt">int</span> a = (n + <span class="dv">1</span>) / <span class="dv">2</span>, b = n - a;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= a * availmax; i++)
        A += dp[a][i] * dp[a][i];
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt;= b * availmax; i++)
        B += dp[b][i] * dp[b][i];
    A %= modr, B %= modr;
    res = (res + modr - A * B % modr) % modr;
    <span class="ot">#endif</span>
    printf(<span class="st">"</span><span class="ch">%lld\n</span><span class="st">"</span>, res);
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre></div>

      </div>
      <div class="post-footer">
        <span class="share">
          <i class="fa fa-share-alt"></i>share to:
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://jeffswt.org//blog/noipemu20num/"><i class="fa fa-facebook"></i>facebook</a>
          <a href="https://twitter.com/intent/tweet?text=https://jeffswt.org//blog/noipemu20num/"><i class="fa fa-twitter"></i>twitter</a>
          <a href="https://plus.google.com/share?url=https://jeffswt.org//blog/noipemu20num/"><i class="fa fa-google-plus"></i>google+</a>
          <a href="https://www.reddit.com/submit?url=https://jeffswt.org//blog/noipemu20num/"><i class="fa fa-reddit"></i>reddit</a>
        </span>
        <hr />
      </div>
    </div>
    <div id="comments-section" data-id="noipemu20num">
    </div>
  </div>
  <div class="page-footer">
    <center><span class="copyright">
      &copy; 2017 jeffswt, all rights reserved.
    </span></center>
  </div>

  <script type="text/javascript" src="/assets/katex/katex.js"></script>
  <script type="text/javascript" src="/assets/katex/contrib/auto-render.js"></script>
  <script type="text/javascript" src="/assets/gitment/gitment.js"></script>
  <script type="text/javascript" src="/assets/main.js"></script>

  <div hidden="hidden">
    <script type="text/javascript" src="https://s11.cnzz.com/z_stat.php?id=1261583208&web_id=1261583208"></script>
  </div>
</body>
</html>
