<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#292d35">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>bzoj4761: [Usaco2017 Jan]Cow Navigation&nbsp;&nbsp;|&nbsp;&nbsp;jeffswt: the ac moments</title>
  <link rel="shortcut icon" href="/assets/images/favicon.png">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/font-awesome.css">
  <link rel="stylesheet" href="/assets/katex/katex.css">
  <link rel="stylesheet" href="/assets/gitment/gitment.css">
</head>

<body>
  <div class="topbar">
    <div class="bar">
      <span class="avatar-icon"><svg version="1.1" height="40px" version="1.1" viewBox="0 0 48 48" width="40px">
        <polygon points="-0.5,16 -0.5,37 0.5,34 0.5,32 1.5,28.8 1.5,24 1.5,21 2.5,17.6 2.5,16 1,14.9 "/>
        <polygon points="44,0.5 45,0.5 46.1,1.1 46.9,1.9 47.2,2.8 47.5,4.8 47.5,7 48,43.8 47.6,45.8 46.4,47.6
        	44.8,48.5 38,48.5 36.8,47.2 36.1,46.1 34.2,44.7 32.6,43.5 31.1,40.8 29.5,38.8 27.8,35.9 26.9,35.4 29.5,35.3 32.7,28.4
        	31.4,27.8 28.7,33.8 26.9,34.1 25.7,33.3 23.5,33.4 21,32.8 19.3,32.2 18.3,30.4 17.3,27.3 19.3,27.9 20.8,26.6 20.4,25.3 21.3,24
        	22.2,23 20.3,21.3 17.8,20.8 16.2,21.5 15.5,23 15.5,25 14.4,26 12.8,26.6 11.2,29.2 10.6,31.1 11.2,34.3 10.9,37.7 11,39.5
        	11.8,42.3 9.5,39.6 8.6,37 7.8,35.1 7.1,33.4 6.6,31 6,28.1 5.6,23.5 6.2,21.8 5.6,19.3 6.3,18.1 8.4,17 10.8,14.5 13,14.5
        	15.8,16.5 19,16.5 22.2,14.3 24,15 25.4,13.5 29,13.5 32.3,12.3 34.5,11.3 36,10.5 36.4,9 39.3,8.8 40.1,7.5 42,7.5 43.6,6.9
        	44,5.3 44.8,3.9 45.2,2.7 "/>
        <polygon points="17.5,34 17.5,37 18.2,37.5 22.8,35.4 21.1,34.7 17.9,34 "/>
        <polygon points="19,43.1 20.6,42.4 22.1,41.4 24,39.5 25,39.5 26.8,41.3 29.3,44.6 24,43.3 "/>
      </svg></span>
      <span class="site-title"><a class="site-title-href" href="/blog/">
        jeffswt: the ac moments
      </a></span>
    </div>
  </div>
  <div class="site-content">
    <div class="blog-post" lang="zh">
      <div class="post-header">
        <h1 class="title">
          bzoj4761: [Usaco2017 Jan]Cow Navigation
        </h1>
        <span class="tags">
          <a class="tag" href="/blog/archive/?q=Problems" target="_self">
            <i class="fa fa-tag"></i> Problems
          </a>
          <a class="tag" href="/blog/archive/?q=BZOJ" target="_self">
            <i class="fa fa-tag"></i> BZOJ
          </a>
          <a class="tag" href="/blog/archive/?q=USACO2017" target="_self">
            <i class="fa fa-tag"></i> USACO2017
          </a>
          <a class="tag" href="/blog/archive/?q=Dynamic Programming" target="_self">
            <i class="fa fa-tag"></i> Dynamic Programming
          </a>
          <a class="tag" href="/blog/archive/?q=Shortest Path" target="_self">
            <i class="fa fa-tag"></i> Shortest Path
          </a>
          <a class="tag" href="/blog/archive/?q=SPFA" target="_self">
            <i class="fa fa-tag"></i> SPFA
          </a>
        </span>
        <span class="date" title="13:48:01 | 3 February, 2017">
          3 February, 2017
        </span>
      </div>
      <div class="post-content">
        <h2 id="description">Description</h2>
<p>Bessie has gotten herself stuck on the wrong side of Farmer John ‘s barn again, and since her vision is so poor, she needs your help navigating across the barn. The barn is described by an <span class="math inline">\(n \times n\)</span> grid of square cells (<span class="math inline">\(2 \leq n \leq 20\)</span>) , some being empty and some containing impassable haybales. Bessie starts in the lower-left corner (cell <span class="math inline">\((1, 1)\)</span>) and wants to move to the upper-right corner (cell <span class="math inline">\((n, n)\)</span>) . You can guide her by telling her a sequence of instructions, each of which is either <em> “forward”</em>“,<em>” turn left 90 degrees “</em>”, or <em> “turn right 90 degrees”</em>“. You want to issue the shortest sequence of instructions that will guide her to her destination. If you instruct Bessie to move off the grid (i. e., into the barn wall) or into a haybale, she will not move and will skip to the next command in your sequence. Unfortunately, Bessie doesn’ t know if she starts out facing up (towards cell <span class="math inline">\((1, 2)\)</span>) or right (towards cell <span class="math inline">\((2, 1)\)</span>) . You need to give the shortest sequence of directions that will guide her to the goal regardless of which case is true. Once she reaches the goal she will ignore further commands.</p>
<p>给定一个 <span class="math inline">\(n \times n\)</span> 的网格 <span class="math inline">\((n \leq 20)\)</span>, 你从左下角出发, 要到达右上角, 网格中会有障碍物你要给定一个长度最短的行为序列 (往前走, 左转, 右转), 使得无论 Bessie 处于左下角时是头朝向上还是朝向左都可以在执行完这个序列后到达右上角. 如果当前的行为会导致 Bessie 走到障碍物上或者越界, 则 Bessie 会忽视这个行为.</p>
<h2 id="input">Input</h2>
<p>The first line of input contains <span class="math inline">\(n\)</span>.</p>
<p>第一行为 <span class="math inline">\(n\)</span> 表示网格大小;</p>
<p>Each of the <span class="math inline">\(n\)</span> following lines contains a string of exactly <span class="math inline">\(n\)</span> characters, representing the barn. The first character of the last line is cell <span class="math inline">\((1, 1)\)</span>. The last character of the first line is cell <span class="math inline">\((n, n)\)</span>. Each character will either be an <code>H</code> to represent a haybale or an <code>E</code> to represent an empty square.</p>
<p>接下来 <span class="math inline">\(n\)</span> 行每行 <span class="math inline">\(n\)</span> 列, 描述这个网格,<code>H</code> 表示障碍物,<code>E</code> 表示空地;</p>
<p>It is guaranteed that cells <span class="math inline">\((1, 1)\)</span> and <span class="math inline">\((n, n)\)</span> will be empty, and furthermore it is guaranteed that there is a path of empty squares from cell <span class="math inline">\((1, 1)\)</span> to cell <span class="math inline">\((n, n)\)</span></p>
<p>数据保证左下角和右上角一定是空地, 且一定有解.</p>
<h2 id="output">Output</h2>
<p>On a single line of output, output the length of the shortest sequence of directions that will guide Bessie to the goal, irrespective whether she starts facing up or right.</p>
<p>输出一个整数, 代表最短命令序列的长度.</p>
<!-- More -->
<h2 id="sample-input">Sample Input</h2>
<pre><code>3
EHE
EEE
EEE</code></pre>
<h2 id="sample-output">Sample Output</h2>
<pre><code>9</code></pre>
<h2 id="explanation">Explanation</h2>
<p>Bessie 首先开始的时候不知道是朝左还是朝右. 所以我们需要将状态拆成两部分, 一部分是 最开始朝左, 另一部分是最开始朝右的状态. 这样我们才可以在命令转移的时候考虑到两种 不同的情况对应的位置.</p>
<p>然后针对每一种情况特判一下就可以了.</p>
<h2 id="source-code">Source Code</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">
<span class="ot">#include &lt;iostream&gt;</span>
<span class="ot">#include &lt;cstdlib&gt;</span>
<span class="ot">#include &lt;cstdio&gt;</span>
<span class="ot">#include &lt;queue&gt;</span>

<span class="ot">#define rep(_var,_begin,_end) for(int _var=_begin;_var&lt;=_end;_var++)</span>
<span class="kw">using</span> <span class="kw">namespace</span> std;
<span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> lli;
<span class="dt">const</span> <span class="dt">int</span> maxn = <span class="dv">25</span>;
<span class="dt">const</span> <span class="dt">int</span> infinit = <span class="bn">0x3fffffff</span>;

<span class="dt">int</span> n, arr[maxn][maxn];
<span class="dt">int</span> dist[maxn][maxn][maxn][maxn][<span class="dv">4</span>][<span class="dv">4</span>];
<span class="dt">bool</span> vis[maxn][maxn][maxn][maxn][<span class="dv">4</span>][<span class="dv">4</span>];

<span class="dt">const</span> <span class="dt">int</span> movx[<span class="dv">4</span>] = { <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">1</span>,  <span class="dv">0</span> },
          movy[<span class="dv">4</span>] = {  <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">-1</span> };

<span class="kw">struct</span> status {
    <span class="dt">int</span> x1, y1, x2, y2, d1, d2;
    status(<span class="dt">int</span> _1, <span class="dt">int</span> _2, <span class="dt">int</span> _3, <span class="dt">int</span> _4, <span class="dt">int</span> _5, <span class="dt">int</span> _6) {
        x1 = _1, y1 = _2, x2 = _3, y2 = _4, d1 = _5, d2 = _6; }
    status(<span class="dt">void</span>) {
        x1 = y1 = x2 = y2 = d1 = d2 = <span class="dv">0</span>; }
};

<span class="dt">bool</span> accessible(<span class="dt">int</span> x, <span class="dt">int</span> y)
{
    <span class="kw">if</span> (x &lt; <span class="dv">1</span> || x &gt; n)
        <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">if</span> (y &lt; <span class="dv">1</span> || y &gt; n)
        <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">if</span> (!arr[x][y])
        <span class="kw">return</span> <span class="kw">false</span>;
    <span class="kw">return</span> <span class="kw">true</span>;
}

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span>** argv)
{
    scanf(<span class="st">"</span><span class="ch">%d</span><span class="st">"</span>, &amp;n);
    rep(i, <span class="dv">1</span>, n) rep(j, <span class="dv">1</span>, n) {
        <span class="dt">char</span> c = <span class="st">'</span><span class="ch">\0</span><span class="st">'</span>;
        <span class="kw">while</span> (c != <span class="st">'E'</span> &amp;&amp; c != <span class="st">'H'</span>) c = getchar();
        arr[i][j] = c == <span class="st">'E'</span>;
    }
    <span class="co">// Finished input data procedures.</span>
    <span class="co">// Clearing relax datum</span>
    rep(x1, <span class="dv">0</span>, n) rep(y1, <span class="dv">0</span>, n) rep(x2, <span class="dv">0</span>, n) rep(y2, <span class="dv">0</span>, n)
        rep(d1, <span class="dv">0</span>, <span class="dv">3</span>) rep(d2, <span class="dv">0</span>, <span class="dv">3</span>)
            dist[x1][y1][x2][y2][d1][d2] = infinit,
            vis[x1][y1][x2][y2][d1][d2] = <span class="kw">false</span>;
    <span class="co">// Now trying SaaS (SPFA-as-a-Service, XD)</span>
    queue&lt;status&gt; que;
    que.push(status(n, <span class="dv">1</span>, n, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>));
    dist[n][<span class="dv">1</span>][n][<span class="dv">1</span>][<span class="dv">0</span>][<span class="dv">1</span>] = <span class="dv">0</span>;
    vis[n][<span class="dv">1</span>][n][<span class="dv">1</span>][<span class="dv">0</span>][<span class="dv">1</span>] = <span class="kw">true</span>;
    <span class="kw">while</span> (!que.empty()) {
        status s = que.front();
        que.pop();
        <span class="dt">int</span> nx1 = s.x1 + movx[s.d1],
            ny1 = s.y1 + movy[s.d1];
        <span class="dt">int</span> nx2 = s.x2 + movx[s.d2],
            ny2 = s.y2 + movy[s.d2];
        <span class="co">// If not accessible, revert to previous configuration</span>
        <span class="kw">if</span> (!accessible(nx1, ny1))
            nx1 = s.x1, ny1 = s.y1;
        <span class="kw">if</span> (!accessible(nx2, ny2))
            nx2 = s.x2, ny2 = s.y2;
        <span class="co">// Target approached, ignoring further movements</span>
        <span class="kw">if</span> (s.x1 == <span class="dv">1</span> &amp;&amp; s.y1 == n)
            nx1 = <span class="dv">1</span>, ny1 = n;
        <span class="kw">if</span> (s.x2 == <span class="dv">1</span> &amp;&amp; s.y2 == n)
            nx2 = <span class="dv">1</span>, ny2 = n;
        <span class="co">// Setting macros for updating new locations</span>
        <span class="ot">#define old_loc(_arr) _arr[s.x1][s.y1][s.x2][s.y2][s.d1][s.d2]</span>
        <span class="ot">#define new_loc(_arr) _arr[nx1][ny1][nx2][ny2][s.d1][s.d2]</span>
        <span class="ot">#define rot_loc(_arr) _arr[s.x1][s.y1][s.x2][s.y2][nd1][nd2]</span>
        <span class="co">// Relaxing new location</span>
        <span class="kw">if</span> (old_loc(dist) + <span class="dv">1</span> &lt; new_loc(dist)) {
            new_loc(dist) = old_loc(dist) + <span class="dv">1</span>;
            <span class="kw">if</span> (!new_loc(vis)) {
                new_loc(vis) = <span class="kw">true</span>;
                que.push(status(nx1, ny1, nx2, ny2, s.d1, s.d2));
            }
        }
        <span class="co">// Relaxing from counter-clockwise rotation</span>
        <span class="dt">int</span> nd1, nd2;
        nd1 = s.d1 - <span class="dv">1</span>, nd2 = s.d2 - <span class="dv">1</span>;
        <span class="kw">if</span> (nd1 &lt; <span class="dv">0</span>) nd1 = <span class="dv">3</span>; <span class="kw">if</span> (nd2 &lt; <span class="dv">0</span>) nd2 = <span class="dv">3</span>;
        <span class="kw">if</span> (old_loc(dist) + <span class="dv">1</span> &lt; rot_loc(dist)) {
            rot_loc(dist) = old_loc(dist) + <span class="dv">1</span>;
            <span class="kw">if</span> (!rot_loc(vis)) {
                rot_loc(vis) = <span class="kw">true</span>;
                que.push(status(s.x1, s.y1, s.x2, s.y2, nd1, nd2));
            }
        }
        <span class="co">// Relaxing from clockwise rotation</span>
        nd1 = s.d1 + <span class="dv">1</span>, nd2 = s.d2 + <span class="dv">1</span>;
        <span class="kw">if</span> (nd1 &gt; <span class="dv">3</span>) nd1 = <span class="dv">0</span>; <span class="kw">if</span> (nd2 &gt; <span class="dv">3</span>) nd2 = <span class="dv">0</span>;
        <span class="kw">if</span> (old_loc(dist) + <span class="dv">1</span> &lt; rot_loc(dist)) {
            rot_loc(dist) = old_loc(dist) + <span class="dv">1</span>;
            <span class="kw">if</span> (!rot_loc(vis)) {
                rot_loc(vis) = <span class="kw">true</span>;
                que.push(status(s.x1, s.y1, s.x2, s.y2, nd1, nd2));
            }
        }
        <span class="co">// Finialized relaxation operations</span>
        <span class="kw">continue</span>;
    }
    <span class="co">// Retrieving results</span>
    <span class="dt">int</span> res = infinit;
    rep(d1, <span class="dv">0</span>, <span class="dv">3</span>) rep(d2, <span class="dv">0</span>, <span class="dv">3</span>)
        res = min(res, dist[<span class="dv">1</span>][n][<span class="dv">1</span>][n][d1][d2]);
    printf(<span class="st">"</span><span class="ch">%d\n</span><span class="st">"</span>, res);
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre></div>

      </div>
      <div class="post-footer">
        <span class="share">
          <i class="fa fa-share-alt"></i>share to:
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://jeffswt.org//blog/bzoj4761/"><i class="fa fa-facebook"></i>facebook</a>
          <a href="https://twitter.com/intent/tweet?text=https://jeffswt.org//blog/bzoj4761/"><i class="fa fa-twitter"></i>twitter</a>
          <a href="https://plus.google.com/share?url=https://jeffswt.org//blog/bzoj4761/"><i class="fa fa-google-plus"></i>google+</a>
          <a href="https://www.reddit.com/submit?url=https://jeffswt.org//blog/bzoj4761/"><i class="fa fa-reddit"></i>reddit</a>
        </span>
        <hr />
      </div>
    </div>
    <div id="comments-section" data-id="bzoj4761">
    </div>
  </div>
  <div class="page-footer">
    <center><span class="copyright">
      &copy; 2017 jeffswt, all rights reserved.
    </span></center>
  </div>

  <script type="text/javascript" src="/assets/katex/katex.js"></script>
  <script type="text/javascript" src="/assets/katex/contrib/auto-render.js"></script>
  <script type="text/javascript" src="/assets/gitment/gitment.js"></script>
  <script type="text/javascript" src="/assets/main.js"></script>

  <div hidden="hidden">
    <script type="text/javascript" src="https://s11.cnzz.com/z_stat.php?id=1261583208&web_id=1261583208"></script>
  </div>
</body>
</html>
