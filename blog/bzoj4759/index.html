<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#292d35">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>bzoj4759: [Usaco2017 Jan]Balanced Photo&nbsp;&nbsp;|&nbsp;&nbsp;jeffswt: the ac moments</title>
  <link rel="shortcut icon" href="/assets/images/favicon.png">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/font-awesome.css">
  <link rel="stylesheet" href="/assets/katex/katex.css">
  <link rel="stylesheet" href="/assets/gitment/gitment.css">
</head>

<body>
  <div class="topbar">
    <div class="bar">
      <span class="avatar-icon"><svg version="1.1" height="40px" version="1.1" viewBox="0 0 48 48" width="40px">
        <polygon points="-0.5,16 -0.5,37 0.5,34 0.5,32 1.5,28.8 1.5,24 1.5,21 2.5,17.6 2.5,16 1,14.9 "/>
        <polygon points="44,0.5 45,0.5 46.1,1.1 46.9,1.9 47.2,2.8 47.5,4.8 47.5,7 48,43.8 47.6,45.8 46.4,47.6
        	44.8,48.5 38,48.5 36.8,47.2 36.1,46.1 34.2,44.7 32.6,43.5 31.1,40.8 29.5,38.8 27.8,35.9 26.9,35.4 29.5,35.3 32.7,28.4
        	31.4,27.8 28.7,33.8 26.9,34.1 25.7,33.3 23.5,33.4 21,32.8 19.3,32.2 18.3,30.4 17.3,27.3 19.3,27.9 20.8,26.6 20.4,25.3 21.3,24
        	22.2,23 20.3,21.3 17.8,20.8 16.2,21.5 15.5,23 15.5,25 14.4,26 12.8,26.6 11.2,29.2 10.6,31.1 11.2,34.3 10.9,37.7 11,39.5
        	11.8,42.3 9.5,39.6 8.6,37 7.8,35.1 7.1,33.4 6.6,31 6,28.1 5.6,23.5 6.2,21.8 5.6,19.3 6.3,18.1 8.4,17 10.8,14.5 13,14.5
        	15.8,16.5 19,16.5 22.2,14.3 24,15 25.4,13.5 29,13.5 32.3,12.3 34.5,11.3 36,10.5 36.4,9 39.3,8.8 40.1,7.5 42,7.5 43.6,6.9
        	44,5.3 44.8,3.9 45.2,2.7 "/>
        <polygon points="17.5,34 17.5,37 18.2,37.5 22.8,35.4 21.1,34.7 17.9,34 "/>
        <polygon points="19,43.1 20.6,42.4 22.1,41.4 24,39.5 25,39.5 26.8,41.3 29.3,44.6 24,43.3 "/>
      </svg></span>
      <span class="site-title"><a class="site-title-href" href="/blog/">
        jeffswt: the ac moments
      </a></span>
    </div>
  </div>
  <div class="site-content">
    <div class="blog-post" lang="zh">
      <div class="post-header">
        <h1 class="title">
          bzoj4759: [Usaco2017 Jan]Balanced Photo
        </h1>
        <span class="tags">
          <a class="tag" href="/blog/archive/?q=Problems" target="_self">
            <i class="fa fa-tag"></i> Problems
          </a>
          <a class="tag" href="/blog/archive/?q=BZOJ" target="_self">
            <i class="fa fa-tag"></i> BZOJ
          </a>
          <a class="tag" href="/blog/archive/?q=USACO2017" target="_self">
            <i class="fa fa-tag"></i> USACO2017
          </a>
          <a class="tag" href="/blog/archive/?q=Splay Tree" target="_self">
            <i class="fa fa-tag"></i> Splay Tree
          </a>
          <a class="tag" href="/blog/archive/?q=Segment Tree" target="_self">
            <i class="fa fa-tag"></i> Segment Tree
          </a>
        </span>
        <span class="date" title="20:01:36 | 29 January, 2017">
          29 January, 2017
        </span>
      </div>
      <div class="post-content">
        <h2 id="description">Description</h2>
<p>Farmer John is arranging his <span class="math inline">\(n\)</span> cows in a line to take a photo <span class="math inline">\((1 \leq n \leq 100000)\)</span>. The height of the <span class="math inline">\(i-th\)</span> cow in sequence is <span class="math inline">\(h_i\)</span>, and the heights of all cows are distinct. As with all photographs of his cows, Farmer John wants this one to come out looking as nice as possible. He decides that cow ii looks “unbalanced” if <span class="math inline">\(L_i\)</span> and <span class="math inline">\(R_i\)</span> differ by more than factor of <span class="math inline">\(2\)</span>, where <span class="math inline">\(L_i\)</span> and <span class="math inline">\(R_i\)</span> are the number of cows taller than <span class="math inline">\(i\)</span> on her left and right, respectively. That is,<span class="math inline">\(i\)</span> is unbalanced if the larger of <span class="math inline">\(L_i\)</span> and <span class="math inline">\(R_i\)</span> is strictly more than twice the smaller of these two numbers. Farmer John is hoping that not too many of his cows are unbalanced. Please help Farmer John compute the total number of unbalanced cows.</p>
<p>农夫约翰正在安排他的 <span class="math inline">\(n\)</span> 头牛拍照片, 每头牛有一个身高, 从 <span class="math inline">\(1\)</span> 到 <span class="math inline">\(n\)</span> 编号, 排列 成一行 <span class="math inline">\((h_1, h_2, \ldots, h_n)\)</span>, 每头牛 <span class="math inline">\(i\)</span> 左边比他高的牛的数量记为 <span class="math inline">\(L_i\)</span>, 右边比他高的牛的数量记为 <span class="math inline">\(R_i\)</span>, 如果存在 <span class="math inline">\(i\)</span> 满足 <span class="math inline">\(max(R_i, L_i) &gt; 2 \times min(L_i, R_i)\)</span> 则这个牛 <span class="math inline">\(i\)</span> 是不平衡的, 现在农夫约翰需要你告诉他有多少头牛不平衡.</p>
<h2 id="input">Input</h2>
<p>The first line of input contains <span class="math inline">\(n\)</span>. The next <span class="math inline">\(n\)</span> lines contain <span class="math inline">\(h_1, \ldots, h_n\)</span> each a nonnegative integer at most <span class="math inline">\(1,000,000,000\)</span>. 输入第一行为 <span class="math inline">\(n (n \leq 10^5)\)</span>, 接下来的一行有 <span class="math inline">\(n\)</span> 个数, 每个数表示第 <span class="math inline">\(i\)</span> 头牛的身高, 不超过 <span class="math inline">\(10^9\)</span>.</p>
<h2 id="output">Output</h2>
<p>Please output a count of the number of cows that are unbalanced.</p>
<p>输出有多少头牛是不平衡的.</p>
<!-- More -->
<h2 id="sample-input">Sample Input</h2>
<pre><code>7
34
6
23
0
5
99
2</code></pre>
<h2 id="sample-output">Sample Output</h2>
<pre><code>3</code></pre>
<h2 id="explanation">Explanation</h2>
<p>直接维护一个 Splay 树就可以了 (虽然线段树+离散化也行).</p>
<p>记得有可能有数值是重复的, 那么 size 就不能直接打标记了.</p>
<p>很奇怪为什么 Splay 没有被卡常~</p>
<h2 id="source-code">Source Code</h2>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">
<span class="ot">#include &lt;iostream&gt;</span>
<span class="ot">#include &lt;cstdlib&gt;</span>
<span class="ot">#include &lt;cstdio&gt;</span>

<span class="ot">#define rep(_var,_begin,_end) for(int _var=_begin;_var&lt;=_end;_var++)</span>
<span class="ot">#define range(_begin,_end) rep(_,_begin,_end)</span>
<span class="ot">#define minimize(__x,__y) __x=min(__x,__y);</span>
<span class="ot">#define maximize(__x,__y) __x=max(__x,__y);</span>
<span class="kw">using</span> <span class="kw">namespace</span> std;
<span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> lli;
<span class="dt">const</span> <span class="dt">int</span> maxn = <span class="dv">200100</span>;
<span class="dt">const</span> <span class="dt">int</span> infinit = <span class="bn">0x7fffffff</span>;

<span class="kw">class</span> SplayTree
{
<span class="kw">public</span>:
    <span class="dt">int</span> arr_i[maxn][<span class="dv">6</span>];
    <span class="ot">#define lc(_x) arr_i[_x][0]</span>
    <span class="ot">#define rc(_x) arr_i[_x][1]</span>
    <span class="ot">#define ch(_x,_y) arr_i[_x][_y]</span>
    <span class="ot">#define par(_x) arr_i[_x][2]</span>
    <span class="ot">#define size(_x) arr_i[_x][3]</span>
    <span class="ot">#define val(_x) arr_i[_x][4]</span>
    <span class="ot">#define vsz(_x) arr_i[_x][5]</span>
    <span class="dt">int</span> root, ncnt;
    <span class="dt">int</span> make_node(<span class="dt">int</span> v)
    {
        <span class="dt">int</span> p = ++ncnt;
        lc(p) = rc(p) = par(p) = <span class="dv">0</span>;
        size(p) = vsz(p) = <span class="dv">1</span>;
        val(p) = v;
        <span class="kw">return</span> p;
    }
    <span class="dt">void</span> update_lazy(<span class="dt">int</span> p)
    {
        size(p) = size(lc(p)) + vsz(p) + size(rc(p));
        <span class="kw">return</span> ;
    }
    <span class="dt">void</span> rotate(<span class="dt">int</span> p)
    {
        <span class="dt">int</span> q = par(p), g = par(q);
        <span class="dt">int</span> x = p == rc(q), y = q == rc(g);
        ch(q, x) = ch(p, !x); <span class="kw">if</span> (ch(q, x)) par(ch(q, x)) = q;
        ch(p, !x) = q; par(q) = p;
        <span class="kw">if</span> (g) ch(g, y) = p; par(p) = g;
        update_lazy(q);
        update_lazy(p);
        <span class="kw">return</span> ;
    }
    <span class="dt">void</span> splay(<span class="dt">int</span> p, <span class="dt">int</span> t)
    {
        <span class="kw">for</span> (<span class="dt">int</span> q = <span class="dv">0</span>; (q = par(p)) &amp;&amp; q != t; rotate(p))
            <span class="kw">if</span> (par(q) &amp;&amp; par(q) != t)
                rotate((q == rc(par(q))) == (p == rc(q)) ? q : p);
        <span class="kw">if</span> (t == <span class="dv">0</span>) root = p;
        <span class="kw">return</span> ;
    }
    <span class="dt">int</span> find(<span class="dt">int</span> x)
    {
        <span class="dt">int</span> p = root;
        <span class="kw">while</span> (<span class="kw">true</span>) {
            <span class="kw">if</span> (x &lt;= size(lc(p))) {
                x = lc(p);
            } x -= size(lc(p));
            <span class="kw">if</span> (x &lt;= vsz(p)) {
                <span class="kw">return</span> p;
            } x -= vsz(p);
            x = rc(p);
        }
        <span class="kw">return</span> p;
    }
    <span class="dt">int</span> insert(<span class="dt">int</span> v)
    {
        <span class="dt">int</span> p = make_node(v);
        <span class="dt">int</span> q = root;
        <span class="kw">while</span> (q != <span class="dv">0</span>) {
            <span class="kw">if</span> (v &lt; val(q)) {
                <span class="kw">if</span> (lc(q)) q = lc(q);
                <span class="kw">else</span> lc(q) = p, par(p) = q, q = <span class="dv">0</span>;
            } <span class="kw">else</span> <span class="kw">if</span> (v &gt; val(q)) {
                <span class="kw">if</span> (rc(q)) q = rc(q);
                <span class="kw">else</span> rc(q) = p, par(p) = q, q = <span class="dv">0</span>;
            } <span class="kw">else</span> {
                vsz(q) += <span class="dv">1</span>;
                p = q;
                q = <span class="dv">0</span>;
            }
        }
        splay(p, <span class="dv">0</span>);
        <span class="kw">return</span> p;
    }
    <span class="dt">int</span> query_greater(<span class="dt">int</span> p)
    {
        splay(p, <span class="dv">0</span>);
        <span class="dt">int</span> res = size(rc(p)) - <span class="dv">1</span>;
        <span class="kw">return</span> res;
    }
    <span class="dt">void</span> init(<span class="dt">void</span>)
    {
        <span class="dt">int</span> lp = make_node(-infinit),
            rp = make_node(infinit);
        root = rp;
        lc(root) = lp, par(lp) = root;
        update_lazy(root);
        <span class="kw">return</span> ;
    }
    <span class="dt">void</span> debug(<span class="dt">void</span>)
    {
        printf(<span class="st">"=&gt; Splay tree contains </span><span class="ch">%d</span><span class="st"> nodes (root </span><span class="ch">%d</span><span class="st">);</span><span class="ch">\n</span><span class="st">"</span>, ncnt, root);
        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= ncnt; i++)
            printf(<span class="st">"   #</span><span class="ch">%d</span><span class="st">: lc </span><span class="ch">%d</span><span class="st"> rc </span><span class="ch">%d</span><span class="st"> par </span><span class="ch">%d</span><span class="st"> size </span><span class="ch">%d</span><span class="st"> val </span><span class="ch">%d</span><span class="st"> vsz </span><span class="ch">%d\n</span><span class="st">"</span>, i, lc(i),
            rc(i), par(i), size(i), val(i), vsz(i));
        <span class="kw">return</span> ;
    }
} stl, str;

<span class="dt">int</span> n, arr[maxn], L[maxn], R[maxn];

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span>** argv)
{
    scanf(<span class="st">"</span><span class="ch">%d</span><span class="st">"</span>, &amp;n);
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; i++)
        scanf(<span class="st">"</span><span class="ch">%d</span><span class="st">"</span>, &amp;arr[i]);
    <span class="co">// After the input of data, construct a dynamic splay tree.</span>
    stl.init();
    str.init();
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; i++) {
        <span class="dt">int</span> p = stl.insert(arr[i]);
        L[i] = stl.query_greater(p);
    }
    <span class="kw">for</span> (<span class="dt">int</span> i = n; i &gt;= <span class="dv">1</span>; i--) {
        <span class="dt">int</span> p = str.insert(arr[i]);
        R[i] = str.query_greater(p);
    }
    <span class="co">// Gathered information.</span>
    <span class="dt">int</span> res = <span class="dv">0</span>;
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= n; i++)
        <span class="kw">if</span> (max(L[i], R[i]) &gt; <span class="dv">2</span> * min(L[i], R[i]))
            res += <span class="dv">1</span>;
    printf(<span class="st">"</span><span class="ch">%d\n</span><span class="st">"</span>, res);
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre></div>

      </div>
      <div class="post-footer">
        <span class="share">
          <i class="fa fa-share-alt"></i>share to:
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://jeffswt.tk//blog/bzoj4759/"><i class="fa fa-facebook"></i>facebook</a>
          <a href="https://twitter.com/intent/tweet?text=https://jeffswt.tk//blog/bzoj4759/"><i class="fa fa-twitter"></i>twitter</a>
          <a href="https://plus.google.com/share?url=https://jeffswt.tk//blog/bzoj4759/"><i class="fa fa-google-plus"></i>google+</a>
          <a href="https://www.reddit.com/submit?url=https://jeffswt.tk//blog/bzoj4759/"><i class="fa fa-reddit"></i>reddit</a>
        </span>
        <hr />
      </div>
    </div>
    <div id="comments-section" data-id="bzoj4759">
    </div>
  </div>
  <div class="page-footer">
    <center><span class="copyright">
      &copy; 2017 jeffswt, all rights reserved.
    </span></center>
  </div>

  <script type="text/javascript" src="/assets/katex/katex.js"></script>
  <script type="text/javascript" src="/assets/katex/contrib/auto-render.js"></script>
  <script type="text/javascript" src="/assets/gitment/gitment.js"></script>
  <script type="text/javascript" src="/assets/main.js"></script>

  <div hidden="hidden">
    <script type="text/javascript" src="https://s11.cnzz.com/z_stat.php?id=1261583208&web_id=1261583208"></script>
  </div>
</body>
</html>
